# 系统架构图（简化版）

## 系统整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                     硬件层 (Hardware)                        │
│  ┌──────────────┐                                           │
│  │  摄像头      │  EAIDK-310开发板                            │
│  │  Camera      │                                           │
│  └──────┬───────┘                                           │
└─────────┼───────────────────────────────────────────────────┘
          │ 视频流
          ▼
┌─────────────────────────────────────────────────────────────┐
│                   应用层 (Application)                        │
│  ┌──────────────┐         ┌──────────────┐                 │
│  │  app.py      │────────▶│  MainWindow  │                 │
│  │  应用入口    │         │  GUI主窗口    │                 │
│  └──────────────┘         └──────┬───────┘                 │
└──────────────────────────────────┼──────────────────────────┘
                                   │
                                   ▼
┌─────────────────────────────────────────────────────────────┐
│                业务逻辑层 (Business Logic)                    │
│  ┌──────────────────────────────────────────────────────┐  │
│  │           VideoThread (视频处理线程)                 │  │
│  │  ┌────────────────────────────────────────────────┐  │  │
│  │  │           检测器模块 (Detectors)                │  │  │
│  │  │  ┌──────────┐  ┌──────────┐  ┌──────────┐     │  │  │
│  │  │  │  Haar    │  │  YOLO11  │  │ FastestV2│     │  │  │
│  │  │  │ Detector │  │ Detector │  │ Detector │     │  │  │
│  │  │  └──────────┘  └──────────┘  └──────────┘     │  │  │
│  │  │  ┌──────────┐                                  │  │  │
│  │  │  │  Face    │                                  │  │  │
│  │  │  │ Tracker  │                                  │  │  │
│  │  │  └──────────┘                                  │  │  │
│  │  └────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                                   │
          ┌────────────────────────┼────────────────────────┐
          │                        │                        │
          ▼                        ▼                        ▼
┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐
│   工具层         │  │   配置层         │  │   数据层         │
│  (Utilities)     │  │  (Config)       │  │  (Data)          │
│                  │  │                  │  │                  │
│  • VideoCapture  │  │  • Config       │  │  • yolo11n.pt    │
│  • FPSCounter    │  │  • config.yaml  │  │  • haarcascades  │
│  • Logger        │  │                  │  │                  │
│  • FileUtils     │  │                  │  │                  │
└──────────────────┘  └──────────────────┘  └──────────────────┘
```

## 数据流向

```
摄像头 → VideoCapture → VideoThread → Detector → 检测结果
                                                      │
                                                      ▼
                                           绘制检测框 + 信息
                                                      │
                                                      ▼
                                            frame_ready信号
                                                      │
                                                      ▼
                                            MainWindow更新显示
```

## 模块依赖关系

```
app.py
  ├── config (配置管理)
  ├── logger (日志系统)
  └── gui.main_window (GUI界面)
        ├── detectors (检测器模块)
        │     ├── haar_detector
        │     ├── yolo11_detector
        │     ├── fastestv2_detector
        │     └── face_tracker
        ├── utils.video (视频工具)
        ├── utils.logger (日志工具)
        └── config (配置管理)
```

## 核心组件说明

### 1. 应用入口 (app.py)
- 初始化配置
- 设置日志系统
- 创建PyQt5应用
- 启动主窗口

### 2. GUI主窗口 (MainWindow)
- 视频显示区域
- 控制按钮（开始/停止）
- 算法选择下拉框
- 统计信息显示（FPS、检测数量）
- 运行日志显示

### 3. 视频处理线程 (VideoThread)
- 独立线程处理视频流
- 调用检测器进行人脸检测
- 计算FPS
- 绘制检测结果
- 通过信号发送帧到GUI

### 4. 检测器模块
- **HaarFaceDetector**: OpenCV Haar级联分类器
- **YOLO11FaceDetector**: Ultralytics YOLO11模型
- **YoloFastestV2Detector**: ONNX格式的轻量级模型
- **FaceTracker**: 基于YOLO11的人脸跟踪

### 5. 工具模块
- **VideoCapture**: 摄像头封装
- **FPSCounter**: FPS计算
- **Logger**: 日志管理
- **FileUtils**: 文件操作

### 6. 配置管理
- YAML配置文件
- 统一配置接口
- 支持默认配置

## 技术栈

| 层级 | 技术 |
|------|------|
| GUI框架 | PyQt5 |
| 计算机视觉 | OpenCV (cv2) |
| 深度学习 | Ultralytics YOLO11, ONNX Runtime |
| 数值计算 | NumPy |
| 配置管理 | PyYAML |
| 日志系统 | Python logging |
| 硬件平台 | EAIDK-310 (ARM) |

## 关键特性

1. **多线程架构**: GUI和视频处理分离，保证界面响应
2. **模块化设计**: 各模块独立，易于扩展和维护
3. **配置驱动**: 所有参数通过配置文件管理
4. **多算法支持**: 支持三种检测算法和跟踪功能
5. **实时性能**: 优化的帧率控制和资源管理

