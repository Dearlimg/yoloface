# 性别识别准确率提升指南

## 当前状态

系统目前使用基于简单特征的分类器，准确率有限（约50-60%）。要获得更高的准确率，需要使用预训练的深度学习模型。

## 准确率对比

| 方法 | 准确率 | 速度 | 模型大小 |
|------|--------|------|----------|
| 简单分类器（当前） | 50-60% | 快 | 无 |
| 预训练Caffe模型 | 85-95% | 中等 | 1-2MB |
| 预训练ONNX模型 | 85-95% | 中等 | 1-2MB |
| 自定义训练模型 | 90-98% | 中等 | 1-5MB |

## 提升准确率的方法

### 方法1：使用预训练模型（推荐，最简单）

#### 步骤1：下载模型

```bash
# 运行下载脚本
python3 scripts/download_gender_model.py

# 或手动下载
mkdir -p models
cd models
wget https://raw.githubusercontent.com/opencv/opencv/master/samples/dnn/face_detector/gender_deploy.prototxt
wget https://github.com/opencv/opencv_extra/raw/master/testdata/dnn/gender_net.caffemodel
```

#### 步骤2：配置模型路径

编辑 `config.yaml`：

```yaml
detection:
  gender:
    enabled: true
    model_path: "models/gender_net.caffemodel"
    prototxt_path: "models/gender_deploy.prototxt"
    input_size: [227, 227]
    mean_values: [104, 117, 123]
    scale: 1.0
```

#### 步骤3：重启程序

```bash
python3 -m yoloface.app
```

**预期效果**：准确率从50-60%提升到85-95%

### 方法2：优化简单分类器（临时方案）

如果暂时无法使用预训练模型，可以调整简单分类器的参数：

编辑 `src/yoloface/detectors/gender_classifier.py` 中的 `_simple_classify` 方法，调整阈值：

```python
# 调整这些阈值可以略微提高准确率
if edge_density > 0.12:  # 可以尝试 0.10-0.15
    male_score += 0.3

if mean_brightness < 110:  # 可以尝试 100-120
    male_score += 0.3
```

**注意**：这种方法提升有限，建议使用预训练模型。

### 方法3：使用更好的检测算法

不同的人脸检测算法会影响性别识别的准确率：

1. **Haar检测器**：检测到的是人脸区域，性别识别准确率较高
2. **YOLO11**：检测的是整个人体，需要从人体区域提取人脸，准确率可能略低
3. **FastestV2**：轻量级，速度较快，但可能影响准确率

**建议**：使用Haar检测器 + 性别识别，准确率最高。

### 方法4：改善输入质量

1. **光照条件**：
   - 确保人脸区域光照充足
   - 避免过暗或过亮
   - 避免强烈背光

2. **人脸角度**：
   - 正面人脸识别准确率最高
   - 侧脸或倾斜角度会降低准确率

3. **人脸大小**：
   - 确保检测到的人脸足够大（建议至少50x50像素）
   - 在 `config.yaml` 中调整检测参数

### 方法5：使用GPU加速

如果系统支持CUDA，模型会自动使用GPU，可以提高处理速度，间接提升准确率（因为可以处理更多帧）。

## 验证准确率

### 测试方法

1. **手动测试**：
   - 运行程序，观察识别结果
   - 记录正确和错误的次数
   - 计算准确率 = 正确次数 / 总次数

2. **使用测试脚本**：
   ```bash
   python3 scripts/test_gender.py
   ```

### 预期准确率

- **简单分类器**：50-60%（随机猜测略好）
- **预训练模型**：85-95%（实际使用中）
- **理想条件**：95%+（正面、光照好、人脸清晰）

## 常见问题

### Q1: 为什么准确率这么低？

**A**: 当前使用的是基于简单特征的分类器，不是深度学习模型。这是设计上的权衡：
- 优点：无需下载模型，快速运行
- 缺点：准确率有限

**解决方案**：下载并使用预训练模型。

### Q2: 下载模型后准确率仍然不高？

**可能原因**：
1. 模型文件损坏或不完整
2. 模型路径配置错误
3. 输入图像质量差
4. 人脸区域提取不正确

**检查方法**：
1. 查看日志文件 `logs/app.log`
2. 确认模型文件存在且可读
3. 检查配置路径是否正确
4. 尝试使用Haar检测器

### Q3: 可以自己训练模型吗？

**A**: 可以，但需要：
1. 收集大量标注好的数据集（至少数千张）
2. 使用深度学习框架（如TensorFlow、PyTorch）训练
3. 导出为Caffe或ONNX格式
4. 调整输入输出格式以匹配代码

### Q4: 如何进一步提高准确率？

**建议**：
1. 使用预训练模型（最重要）
2. 改善光照条件
3. 确保人脸正面、清晰
4. 使用Haar检测器
5. 考虑使用更先进的模型（如ResNet、MobileNet等）

## 总结

要获得高准确率的性别识别：

1. ✅ **必须**：使用预训练深度学习模型
2. ✅ **推荐**：使用Haar检测器
3. ✅ **优化**：改善光照和拍摄角度
4. ✅ **可选**：使用GPU加速

简单分类器仅作为演示和备用方案，不适合实际应用。

