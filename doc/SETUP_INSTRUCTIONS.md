# 登录注册系统设置说明

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 运行程序

```bash
python app_main.py
```

程序启动时会自动显示登录注册界面。

## 系统功能

### 新增功能

1. **用户登录** - 使用已注册的账号登录系统
2. **用户注册** - 创建新的用户账号
3. **密码加密** - 使用SHA256加密存储密码
4. **数据库存储** - 用户信息存储在远程MySQL数据库中

### 数据库配置

- **主机**: 113.44.144.219
- **端口**: 3306
- **用户名**: root
- **密码**: 123456
- **数据库**: yoloface
- **表名**: mv_user

## 文件说明

### 新增文件

| 文件名 | 说明 |
|--------|------|
| `db_manager.py` | 数据库管理模块，处理MySQL连接和用户认证 |
| `login_ui.py` | 登录注册UI界面 |
| `test_db_connection.py` | 数据库连接测试脚本 |
| `LOGIN_GUIDE.md` | 详细的登录注册使用指南 |
| `SETUP_INSTRUCTIONS.md` | 本文件，设置说明 |

### 修改文件

| 文件名 | 修改内容 |
|--------|---------|
| `app_main.py` | 添加登录界面，在启动时显示登录对话框 |
| `requirements.txt` | 添加MySQL连接库依赖 |

## 使用流程

### 首次使用

1. 运行 `python app_main.py`
2. 在登录界面点击"去注册"
3. 输入用户名（至少3个字符）和密码（至少6个字符）
4. 点击"注册"按钮
5. 注册成功后返回登录界面
6. 输入用户名和密码进行登录
7. 登录成功后进入主界面

### 后续使用

1. 运行 `python app_main.py`
2. 输入用户名和密码
3. 点击"登录"按钮
4. 登录成功后进入主界面

## 验证规则

### 用户名
- 长度至少3个字符
- 必须唯一（不能重复）
- 支持字母、数字、下划线等

### 密码
- 长度至少6个字符
- 使用SHA256加密存储
- 登录时自动验证

## 故障排除

### 问题1：无法连接到数据库

**症状**: 显示"无法连接到数据库"错误

**解决方案**:
1. 检查网络连接
2. 确认数据库服务器地址 `113.44.144.219` 是否可访问
3. 验证数据库用户名和密码是否正确
4. 检查防火墙设置，确保允许3306端口

### 问题2：导入错误

**症状**: `ModuleNotFoundError: No module named 'mysql'`

**解决方案**:
```bash
pip install PyMySQL
# 或
pip install mysql-connector-python
```

### 问题3：用户名已存在

**症状**: 注册时显示"用户名已存在"

**解决方案**: 使用不同的用户名进行注册

### 问题4：密码错误

**症状**: 登录时显示"密码错误"

**解决方案**: 检查大小写，确保密码输入正确

## 测试数据库连接

运行测试脚本验证数据库连接：

```bash
python test_db_connection.py
```

输出示例：
```
正在测试数据库连接...
✓ 数据库连接成功
✓ 用户表创建/验证成功

测试注册功能...
  注册结果: 注册成功

测试登录功能...
  登录结果: 登录成功

测试错误密码...
  登录结果: 密码错误

✓ 所有测试完成
```

## 修改数据库配置

如需修改数据库配置，编辑以下文件：

### 方法1：修改 `db_manager.py`

在 `DatabaseManager` 类的 `__init__` 方法中修改默认参数：

```python
def __init__(self, host='your_host', port=3306, user='your_user',
             password='your_password', database='your_database'):
```

### 方法2：修改 `login_ui.py`

在 `LoginRegisterDialog` 类的 `init_database` 方法中修改：

```python
self.db_manager = DatabaseManager(
    host='your_host',
    port=3306,
    user='your_user',
    password='your_password',
    database='your_database'
)
```

## 安全建议

1. **生产环境**: 修改数据库密码，不要使用默认密码
2. **密码加密**: 系统使用SHA256加密，建议在生产环境中使用更强的加密算法
3. **数据库备份**: 定期备份用户数据
4. **访问控制**: 限制数据库访问权限

## 常见问题

### Q: 如何重置用户密码？

A: 目前系统不支持密码重置功能。如需重置，可以：
1. 直接在数据库中删除用户记录
2. 使用新用户名重新注册

### Q: 如何导出用户数据？

A: 可以使用MySQL客户端工具导出数据：
```sql
SELECT * FROM mv_user;
```

### Q: 系统支持多用户同时登录吗？

A: 支持。每个用户可以独立登录，系统会在窗口标题显示当前登录用户。

### Q: 如何删除用户账号？

A: 目前系统不支持删除账号功能。可以直接在数据库中删除用户记录。

## 技术栈

- **GUI框架**: PyQt5
- **数据库**: MySQL
- **Python驱动**: PyMySQL / mysql-connector-python
- **加密**: hashlib (SHA256)

## 支持的Python版本

- Python 3.7+

## 许可证

本项目遵循原项目许可证。

## 联系方式

如有问题，请查看 `LOGIN_GUIDE.md` 获取更多信息。

